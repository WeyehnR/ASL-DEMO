/* ==========================================================================
   CSS Custom Properties (Design Tokens)
   ========================================================================== */

:root {
    /* --- Spacing Scale --- */
    --space-xs: 2px;
    --space-sm: 4px;
    --space-md: 8px;
    --space-lg: 12px;
    --space-xl: 15px;
    --space-2xl: 20px;

    /* --- Border Radius --- */
    --radius-sm: 2px;
    --radius-md: 4px;
    --radius-lg: 8px;
    --radius-xl: 12px;

    /* --- Typography --- */
    --font-sans: Arial, sans-serif;
    --font-serif: Georgia, serif;
    --text-xs: 10px;
    --text-sm: 11px;
    --text-base: 12px;
    --text-md: 13px;
    --text-lg: 14px;
    --text-xl: 16px;

    /* --- Neutral Palette --- */
    --neutral-50: #fafafa;
    --neutral-100: #f5f5f5;
    --neutral-300: #aaa;
    --neutral-400: #888;
    --neutral-500: #666;
    --neutral-600: #555;
    --neutral-700: #444;
    --neutral-800: #333;
    --neutral-850: #2a2a2a;
    --neutral-900: #1a1a1a;
    --neutral-950: #000;

    /* --- Brand Colors --- */
    --color-primary: #4CAF50;
    --color-primary-hover: #45a049;
    --color-danger: #f44336;
    --color-danger-hover: #d32f2f;
    --color-success: #90EE90;
    --color-link: #0066cc;

    /* --- Highlight Colors --- */
    --highlight-default: yellow;
    --highlight-active: #ff9800;
    --highlight-active-outline: #ff5722;

    /* --- Sidebar Panel --- */
    --panel-bg: var(--neutral-800);
    --panel-text: #fff;
    --panel-width: 250px;
    --panel-z: 9999;

    /* --- Popup --- */
    --popup-bg: var(--neutral-900);
    --popup-header-bg: var(--neutral-850);
    --popup-border: var(--neutral-800);
    --popup-text: #fff;
    --popup-muted: var(--neutral-400);
    --popup-video-bg: var(--neutral-950);
    --popup-width: 240px;
    --popup-video-height: 180px;
    --popup-z: 10000;

    /* --- Article --- */
    --article-bg: var(--neutral-50);
    --article-heading: var(--neutral-800);
    --article-text: #444;

    /* --- Word Chips --- */
    --chip-bg: var(--neutral-600);
    --chip-bg-hover: var(--color-primary);
    --chip-text: #fff;

    /* --- Section Headers --- */
    --section-bg: var(--neutral-700);
    --section-bg-hover: var(--neutral-600);

    /* --- Inputs --- */
    --input-bg: var(--neutral-700);
    --input-text: #fff;
    --input-placeholder: var(--neutral-400);

    /* --- Nav Buttons --- */
    --nav-bg: var(--neutral-600);
    --nav-bg-hover: var(--neutral-500);
}

/* ==========================================================================
   Base / Layout
   ========================================================================== */

body {
    font-family: var(--font-serif);
    max-width: 800px;
    margin: 0 auto;
    padding: var(--space-2xl);
    padding-inline-end: calc(var(--panel-width) + 40px);
    line-height: 1.6;
}

/* ==========================================================================
   Sidebar Panel
   ========================================================================== */

#test-controls {
    position: fixed;
    inset: 10px 10px 10px auto;
    width: var(--panel-width);
    background: var(--panel-bg);
    color: var(--panel-text);
    padding: var(--space-xl);
    border-radius: var(--radius-lg);
    z-index: var(--panel-z);
    font-family: var(--font-sans);
    display: flex;
    flex-direction: column;

    & h3 {
        margin: 0 0 var(--space-md) 0;
        font-size: var(--text-lg);
    }

    & input {
        padding: var(--space-md);
        margin-inline-end: 5px;
        border: none;
        border-radius: var(--radius-md);
        width: 120px;
    }

    & button:not(.word-section-header):not(.word-chip):not(.nav-btn) {
        padding: var(--space-md) var(--space-lg);
        background: var(--color-primary);
        color: var(--panel-text);
        border: none;
        border-radius: var(--radius-md);
        cursor: pointer;
        margin: var(--space-xs);

        &:hover {
            background: var(--color-primary-hover);
        }

        &.clear {
            background: var(--color-danger);

            &:hover {
                background: var(--color-danger-hover);
            }
        }
    }
}

/* ==========================================================================
   Results & Match Navigation
   ========================================================================== */

#result {
    margin-block-start: var(--space-md);
    font-size: var(--text-lg);
    color: var(--color-success);
}

.result-nav {
    display: flex;
    align-items: center;
    gap: var(--space-md);
}

.result-position {
    font-size: var(--text-md);
    min-width: 60px;
    text-align: center;
}

.nav-btn {
    padding: var(--space-sm) var(--space-md);
    background: var(--nav-bg);
    color: var(--panel-text);
    border: none;
    border-radius: var(--radius-md);
    cursor: pointer;
    font-size: var(--text-base);

    &:hover {
        background: var(--nav-bg-hover);
    }
}

/* ==========================================================================
   Highlight Marks
   ========================================================================== */

mark {
    background: var(--highlight-default);
    padding: 0 var(--space-xs);
    border-radius: var(--radius-sm);

    &.current-match {
        background: var(--highlight-active);
        outline: 2px solid var(--highlight-active-outline);
        outline-offset: 1px;
    }
}

/* ==========================================================================
   Word Chips Panel
   ========================================================================== */

#word-chips {
    flex: 1;
    overflow-x: hidden;
    overflow-y: auto;
    margin-block-end: var(--space-md);
    display: flex;
    flex-direction: column;
}

/* --- Search Input --- */

.word-search-container {
    display: flex;
    align-items: center;
    gap: var(--space-md);
    margin-block-end: var(--space-md);
    flex-shrink: 0;
}

.word-search-input {
    flex: 1;
    padding: var(--space-md) var(--space-md);
    border: none;
    border-radius: var(--radius-md);
    background: var(--input-bg);
    color: var(--input-text);
    font-size: var(--text-md);
    width: auto;

    &::placeholder {
        color: var(--input-placeholder);
    }

    &:focus {
        outline: 2px solid var(--color-primary);
    }
}

.word-count {
    font-size: var(--text-sm);
    color: var(--neutral-400);
    white-space: nowrap;
}

/* --- Collapsible Sections --- */

.word-sections {
    flex: 1;
    overflow-x: hidden;
    overflow-y: auto;
}

.word-section {
    margin-block-end: var(--space-xs);
}

.word-section-header {
    display: flex;
    align-items: center;
    gap: 6px;
    width: 100%;
    padding: 6px var(--space-md);
    background: var(--section-bg);
    border: none;
    border-radius: var(--radius-md);
    color: var(--panel-text);
    cursor: pointer;
    font-size: var(--text-md);
    text-align: left;

    &:hover {
        background: var(--section-bg-hover);
    }
}

.word-section-arrow {
    font-size: var(--text-xs);
    transition: transform 0.2s;

    .word-section:not(.collapsed) & {
        transform: rotate(90deg);
    }
}

.word-section-letter {
    font-weight: 600;
}

.word-section-count {
    color: var(--neutral-300);
    font-size: var(--text-sm);
    margin-inline-start: auto;
}

.word-section-content {
    padding: 6px 0 6px var(--space-sm);
    overflow-x: hidden;

    .word-section.collapsed & {
        display: none;
    }
}

/* --- Chips --- */

.word-chips-flat {
    padding: var(--space-sm) 0;
}

.no-results {
    color: var(--neutral-400);
    font-size: var(--text-md);
    padding: var(--space-2xl);
    text-align: center;
}

.word-chip {
    display: inline-block;
    padding: var(--space-sm) var(--space-md);
    margin: var(--space-xs);
    background: var(--chip-bg);
    color: var(--chip-text);
    border: none;
    border-radius: var(--radius-xl);
    font-size: var(--text-base);
    cursor: pointer;

    &:hover {
        background: var(--chip-bg-hover);
    }
}

/* ==========================================================================
   Article Content
   ========================================================================== */

#article-container {
    background: var(--article-bg);
    padding: var(--space-2xl);
    border-radius: var(--radius-lg);

    & h1 {
        color: var(--article-heading);
    }

    & p {
        margin-block: var(--space-xl);
        color: var(--article-text);
    }

    & a {
        color: var(--color-link);
    }
}

/* ==========================================================================
   ASL Video Popup
   ========================================================================== */

#asl-video-popup {
    display: none;
    position: absolute;
    z-index: var(--popup-z);
    background: var(--popup-bg);
    border-radius: var(--radius-xl);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
    width: var(--popup-width);
    overflow: hidden;
    font-family: var(--font-sans);

    &.loading .asl-popup-loading {
        display: block;
    }

    &.no-video .asl-popup-no-video {
        display: block;
    }

    &.has-video .asl-popup-video {
        display: block;
    }
}

.asl-popup-header {
    display: flex;
    align-items: center;
    background: var(--popup-header-bg);
    padding: var(--space-md) var(--space-lg);
    border-bottom: 1px solid var(--popup-border);
}

.asl-popup-title {
    color: var(--popup-text);
    font-size: var(--text-base);
    font-weight: 500;
}

.asl-popup-video-container {
    position: relative;
    width: 100%;
    height: var(--popup-video-height);
    background: var(--popup-video-bg);
}

.asl-popup-video {
    width: 100%;
    height: 100%;
    object-fit: contain;
    display: none;
}

.asl-popup-loading,
.asl-popup-no-video {
    position: absolute;
    inset: 0;
    display: none;
    place-content: center;
    color: var(--popup-muted);
    font-size: var(--text-lg);
    /* Fallback for centering */
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
}

.asl-popup-word {
    padding: var(--space-md) var(--space-lg) var(--space-sm);
    color: var(--popup-text);
    font-size: var(--text-xl);
    font-weight: 600;
    text-align: center;
    background: var(--popup-header-bg);
    border-top: 1px solid var(--popup-border);
}

.asl-popup-meanings {
    padding: var(--space-sm) var(--space-lg) var(--space-md);
    color: var(--popup-muted);
    font-size: var(--text-base);
    text-align: center;
    background: var(--popup-header-bg);
    font-style: italic;
}

.asl-popup-lexical-class {
    color: var(--popup-muted);
    font-size: var(--text-xs);
    font-weight: normal;
    margin-inline-start: var(--space-md);
    padding: var(--space-xs) 6px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: var(--radius-md);
}

/* --- Close & Fullscreen Buttons (hidden until expanded) --- */

.asl-popup-close,
.asl-popup-fullscreen {
    display: none;
}

.asl-popup-close {
    margin-inline-start: auto;
    background: none;
    border: none;
    color: var(--popup-muted);
    font-size: var(--text-xl);
    cursor: pointer;
    padding: 0 var(--space-sm);
    line-height: 1;

    &:hover {
        color: var(--popup-text);
    }
}

.asl-popup-fullscreen {
    position: absolute;
    bottom: var(--space-md);
    right: var(--space-md);
    background: rgba(0, 0, 0, 0.6);
    border: none;
    color: var(--popup-text);
    font-size: var(--text-lg);
    cursor: pointer;
    padding: var(--space-sm) var(--space-md);
    border-radius: var(--radius-md);
    z-index: 1;

    &:hover {
        background: rgba(0, 0, 0, 0.8);
    }
}

/* --- Expanded State --- */

#asl-video-popup.expanded {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 480px;

    & .asl-popup-close,
    & .asl-popup-fullscreen {
        display: block;
    }

    & .asl-popup-video-container {
        height: 360px;
    }

    & .asl-popup-word {
        font-size: var(--text-xl);
    }

    & .asl-popup-meanings {
        font-size: var(--text-lg);
    }
}
